---
layout:     post
title:      平台防SQL、XSS注入方案
subtitle:   安全
date:       2018-12-26
author:     
header-img: img/tag-bg-o.jpg
catalog: true
tags:
    - 安全
---

## 前言

SQL注入技术是利用web应用程序和数据库服务器之间的接口来篡改网站内容的攻击技术。通过把SQL命令插入到Web表单提交框、输入域名或页面请求框中，最终欺骗服务器执行恶意的SQL命令。SQL注入能使攻击者绕过认证机制，完全控制服务器上的数据库。SQL是结构化查询语言的简称，它是访问数据库的事实标准。目前，大多数Web应用都是使用SQL数据库来存放应用程序的数据。几乎所有的Web应用在后台都使用某种SQL数据库。跟大多数语言一样，SQL语法允许数据库命令和用户数据是混杂在一起的。如果开发人员不细心的话，用户数据就有可能被解释成命令，这样的话，远程用户就不仅能向Web应用输入数据，而且还可以在数据库上执行任意命令了。

跨站点脚本（XSS）是一种常见的web应用程序漏洞，攻击者使用这个漏洞注入恶意代码（例如JavaScript）来攻击受害者的web浏览器。使用恶意代码，攻击者可以轻松窃取受害者的凭证，例如cookies。浏览器使用的保护措施会因为恶意代码拥有受害者的凭证而失效，因此这种漏洞会导致大规模的浏览器被利用。XSS（Cross Site Scripting）：跨站脚本攻击，它与SQL注入攻击类似，SQL注入攻击中以SQL语句作为用户输入，从而达到查询/修改/删除数据的目的；而在xss攻击中，恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页时，嵌入Web里面的html代码会被执行，从而达到恶意攻击用户的特殊目的。

本文档的目标是总结利用SQL注入和跨站点脚本漏洞攻击的常用方法，并通过掌握的技术来阻止此类攻击的发生。

## SQL注入的原理

定义：通过把SQL命令写入用户提交的数据中，改变代码原有的SQL语句的语义，从而达到控制服务器执行恶意的SQL命令，导致可写入任意SQL语句并执行。

下面演示经典的SQL注入

```
mysql> select id, name from users where id=2;
+----+-------+
| id + name  |
+----+-------+
|  2 | neunn |
+----+-------+
1 row in set (0.001 sec)

mysql> select id, name from users where id=2 or 1=1;
+----+----------+
| id | name     |
+----+----------+
|  1 | smile    |
|  2 | neunn    |
|  3 | supermap |
+----+----------+
3 rows in set (0.00 sec)

mysql> select count(*) from users;
+----------+
| count(*) |
+----------+
|        3 |
+----------+
1 row in set (0,001 sec)

mysql>
```
我们看到：```select id, name from users where id=2;```
如果该语句是通过sql字符串拼接得到的，比如：```String sql = "select id, name from user where id=" + id;```。其中的id是一个用户输入的参数，那么，如果用户输入的是2，那么上面看到查到了一条数据，如果用户输入的是 ```2 or 1=1``` 进行sql注入攻击，那么看到，上面的语句```select id, name from users where id=2 or 1=1;``` 将users表中的所有记录都查出来了。这就是典型的sql注入。


## SQL注入的危害

1. 非法读取、篡改、添加、删除数据库中的数据。
2. 盗取用户的各类敏感信息，获取利益。
3. 通过修改数据库来修改网页上的内容。
4. 私自添加或删除账号。
5. 注入木马等等。


